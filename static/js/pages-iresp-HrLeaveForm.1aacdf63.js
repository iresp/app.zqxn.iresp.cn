(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-iresp-HrLeaveForm"],{"064b":function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("aa9c"),a("5ef2"),a("dd2b"),a("5c47"),a("a1c1"),a("45da");var n=i(a("9b1b")),s=i(a("2634")),o=i(a("2fdc")),l=a("2d6f"),c=i(a("6e31")),u={name:"HrLeaveForm",components:{myDate:c.default},props:{formData:{type:Object,default:function(){},required:!1}},data:function(){return{id:"",CustomBar:this.CustomBar,NavBarColor:this.NavBarColor,loading:!1,imgList:[],model:{bpmStatus:"0"},backRouteName:"HrLeaveList",url:{queryById:"/iresp/hrLeave/queryById",add:"/iresp/hrLeave/add",edit:"/iresp/hrLeave/edit"},uploadUrl:"/sys/common/upload",LeaveTypeList:[],LeaveTypeIndex:0}},onLoad:function(e){this.id=e.id},created:function(){this.initFormData()},methods:{initFormData:function(){var e=this;return(0,o.default)((0,s.default)().mark((function t(){var a;return(0,s.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initLeaveType();case 2:e.id?e.$http.get(e.url.queryById,{params:{id:e.id}}).then((function(t){if(t.data.success){if(console.log("表单数据",t),e.model=t.data.result,e.model.note){e.imgList=e.model.note.split(","),console.log(e.imgList);for(var a=0;a<e.imgList.length;a++)e.imgList[a]=e.$config.apiUrl+"/sys/common/static/"+e.imgList[a];console.log(e.imgList)}else e.imgList=[];for(var i=0;i<e.LeaveTypeList.length;i++)if(e.LeaveTypeList[i].split("|")[1]==e.model.leaveType){e.LeaveTypeIndex=i;break}}})):(a=new Date,e.model={name:uni.getStorageSync(l.USER_INFO).username,leaveType:"1",days:1,beginDate:a.getFullYear()+"-"+(a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1))+"-"+(a.getDate()>9?a.getDate():"0"+a.getDate()),endDate:a.getFullYear()+"-"+(a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1))+"-"+(a.getDate()+1>9?a.getDate()+1:"0"+(a.getDate()+1)),reason:"",note:"",bpmStatus:"0"});case 3:case"end":return t.stop()}}),t)})))()},initLeaveType:function(){var e=this;return(0,o.default)((0,s.default)().mark((function t(){var a,i,n;return(0,s.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/sys/dict/getDictItems/leave_type");case 2:if(a=t.sent,a.data.success){for(i=[],n=0;n<a.data.result.length;n++)i.push(a.data.result[n].text+"|"+a.data.result[n].value);e.LeaveTypeList=i}case 4:case"end":return t.stop()}}),t)})))()},ChooseImage:function(){var e=this,t=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(a){t.$http.upload(t.$config.apiUrl+t.uploadUrl,{filePath:a.tempFilePaths[0],name:"file"}).then((function(t){e.imgList.push(e.$config.apiUrl+"/sys/common/static/"+t.data.message),e.model.note.indexOf(",")<0?e.model.note=t.data.message:e.model.note+=","+t.data.message})).catch((function(e){t.$tip.error(e.data.message)}))}})},ViewImage:function(e){uni.previewImage({urls:this.imgList,current:e.currentTarget.dataset.url})},DelImg:function(e){var t=this;uni.showModal({title:"删除附件",content:"确定要删除附件吗？",cancelText:"取消",confirmText:"确定",success:function(a){a.confirm&&(console.log(t.imgList),t.imgList.splice(e.currentTarget.dataset.index,1),console.log(t.imgList))}})},leaveTypePickerChange:function(e){this.LeaveTypeIndex=e.detail.value},onSubmit:function(){for(var e=this,t=(0,n.default)({},this.model),a=0;a<this.imgList.length;a++)0==a?t.note=this.imgList[a].replaceAll(this.$config.apiUrl+"/sys/common/static/",""):t.note+=","+this.imgList[a].replaceAll(this.$config.apiUrl+"/sys/common/static/","");t.leaveType=this.LeaveTypeList[this.LeaveTypeIndex].split("|")[1],this.loading=!0;var i=t.id?this.url.edit:this.url.add;this.$http.post(i,t).then((function(t){console.log("res",t),e.loading=!1,e.$Router.push({name:e.backRouteName})})).catch((function(){e.loading=!1}))}}};t.default=u},"44bd":function(e,t,a){"use strict";a.r(t);var i=a("064b"),n=a.n(i);for(var s in i)["default"].indexOf(s)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(s);t["default"]=n.a},b802:function(e,t,a){"use strict";a.r(t);var i=a("c704"),n=a("44bd");for(var s in n)["default"].indexOf(s)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(s);var o=a("828b"),l=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=l.exports},c704:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",[a("cu-custom",{attrs:{bgColor:e.NavBarColor,isBack:!0,backRouterName:e.backRouteName}},[a("template",{attrs:{slot:"backText"},slot:"backText"},[e._v("返回")]),a("template",{attrs:{slot:"content"},slot:"content"},[e._v("请假")])],2),a("v-uni-view",[a("v-uni-form",[a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"flex align-center"},[a("v-uni-view",{staticClass:"title"},[a("v-uni-text",{attrs:{space:"ensp"}},[e._v("请假人：")])],1),a("v-uni-input",{attrs:{placeholder:"请输入请假人",disabled:"true"},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1)],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"flex align-center"},[a("v-uni-view",{staticClass:"title"},[a("v-uni-text",{attrs:{space:"ensp"}},[e._v("请假类型：")])],1),a("v-uni-view",{staticClass:"uni-list-cell-db"},[a("v-uni-picker",{attrs:{value:e.LeaveTypeIndex,range:e.LeaveTypeList},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.leaveTypePickerChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"uni-input"},[e._v(e._s(e.LeaveTypeList[e.LeaveTypeIndex]?e.LeaveTypeList[e.LeaveTypeIndex].split("|")[0]:""))])],1)],1)],1)],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"flex align-center"},[a("v-uni-view",{staticClass:"title"},[a("v-uni-text",{attrs:{space:"ensp"}},[e._v("请假天数：")])],1),a("v-uni-input",{attrs:{type:"number",placeholder:"请输入请假天数",min:.5,precision:1},model:{value:e.model.days,callback:function(t){e.$set(e.model,"days",t)},expression:"model.days"}})],1)],1),a("my-date",{attrs:{label:"开始时间：",fields:"day",placeholder:"请输入开始时间"},model:{value:e.model.beginDate,callback:function(t){e.$set(e.model,"beginDate",t)},expression:"model.beginDate"}}),a("my-date",{attrs:{label:"结束时间：",fields:"day",placeholder:"请输入结束时间"},model:{value:e.model.endDate,callback:function(t){e.$set(e.model,"endDate",t)},expression:"model.endDate"}}),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"flex align-center"},[a("v-uni-view",{staticClass:"title"},[a("v-uni-text",{attrs:{space:"ensp"}},[e._v("请假原因：")])],1),a("v-uni-input",{attrs:{placeholder:"请输入请假原因"},model:{value:e.model.reason,callback:function(t){e.$set(e.model,"reason",t)},expression:"model.reason"}})],1)],1),a("v-uni-view",{staticClass:"cu-form-group"},[a("v-uni-view",{staticClass:"title"},[a("v-uni-text",{attrs:{space:"ensp"}},[e._v("附件：")])],1),a("v-uni-view",{staticClass:"grid col-4 grid-square flex-sub"},[e._l(e.imgList,(function(t,i){return a("v-uni-view",{key:i,staticClass:"bg-img",attrs:{"data-url":e.imgList[i]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.ViewImage.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:e.imgList[i],mode:"aspectFill"}}),a("v-uni-view",{staticClass:"cu-tag bg-red radius",attrs:{"data-index":i},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.DelImg.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-close"})],1)],1)})),e.imgList.length<1?a("v-uni-view",{staticClass:"solids",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.ChooseImage.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"cuIcon-cameraadd"})],1):e._e()],2)],1),a("v-uni-view",{staticClass:"padding"},["0"==e.model.bpmStatus||"1"==e.model.bpmStatus||"4"==e.model.bpmStatus?a("v-uni-button",{staticClass:"cu-btn block bg-blue margin-tb-sm lg",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onSubmit.apply(void 0,arguments)}}},[e.loading?a("v-uni-text",{staticClass:"cuIcon-loading2 cuIconfont-spin"}):e._e(),e._v("保存")],1):e._e()],1)],1)],1)],1)},n=[]}}]);